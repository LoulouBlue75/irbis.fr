# Screen Contract: Candidate Profile (Shared View)
# ID: SC-05
# Format: Matrice v4.1 (9 sections)
# Note: Public/shareable view of a talent for client presentation

screen:
  route: /share/candidate/[token]
  name: "Profil Candidat (Vue Partagee)"
  id: SC-05
  visibility: public
  vocabulary:
    talent: "Talent" # Not "Candidat"
    footprint: "Empreinte" # Not "CV"

context:
  origin:
    - Share link sent to client via email
    - Client portal (V2)
    - Recruiter preview mode
  prerequisites:
    - Valid share token (non-expired)
    - Candidate consent given (GDPR compliance)
    - Token not revoked
  frequency: Occasional, for client presentations

goal:
  primary: "Presenter un talent de maniere professionnelle au client"
  secondary:
    - Afficher uniquement les informations autorisees
    - Permettre au client de donner son feedback
    - Proteger les donnees sensibles du candidat
    - Projeter l'image premium Irbis
  success_criteria:
    - Client can evaluate talent in < 2 min
    - No sensitive data exposed (email, phone if anonymized)
    - Professional branded presentation
    - Easy feedback submission

nudge_logic:
  conditions:
    - id: NUD-CP-001
      priority: 3
      condition: "token_expires_in < 24h"
      message: "Ce lien expire dans moins de 24h"
      variant: warning
      visible_to: [recruiter_preview]
    - id: NUD-CP-002
      priority: 4
      condition: "client_feedback_pending"
      message: "En attente du retour client"
      variant: info
      visible_to: [recruiter_preview]
  max_visible: 1
  ordering: priority ASC

states:
  default:
    description: "Profile loaded for presentation"
    sections_visible:
      - header (name or anonymized, photo or generic)
      - synthesis (AI-generated pitch)
      - dimensions_8d (behavioral profile)
      - career_path (experience timeline)
      - alignments (matching mandates if applicable)
      - recruiter_comment (if added)
  loading:
    description: "Validating token and loading profile"
    skeleton: true
    branded: true
    skeleton_layout:
      - type: header-skeleton
      - type: card-skeleton
        count: 4
  expired:
    description: "Share token has expired"
    error_code: 410
    message: "Ce lien a expire. Contactez votre recruteur pour un nouveau lien."
    show_contact: true
  invalid:
    description: "Token is invalid or revoked"
    error_code: 403
    message: "Ce lien n'est plus valide."
  error:
    description: "Server error"
    fallback: error-page
    message: "Impossible de charger le profil"

parity:
  anonymized_mode:
    show: [synthesis, dimensions_8d, career_redacted, skills]
    hide: [name, photo, contact, company_names, linkedin]
    placeholders:
      name: "Talent A"
      photo: generic_avatar
      companies: "[Entreprise confidentielle]"
  full_mode:
    show: [all_profile_fields]
    hide: [internal_notes, private_comments, salary_expectation]
  recruiter_preview:
    show: [all_fields]
    badge: "Apercu recruteur"
    actions: [edit_visibility, copy_link, revoke_link, extend_expiry]

components:
  layout:
    - PublicLayout (minimal, branded)
    - SplitScreenLayout (2fr 1fr)
  left_column:
    profile_header:
      component: CandidateShareHeader
      props: [name_or_placeholder, avatar_or_generic, title, location]
      elements:
        - avatar (xl, with fallback initials)
        - name (h1, text-h2 font-bold)
        - contact_row (if full_mode)
        - edit_button (if recruiter_preview)
    synthesis_card:
      component: Card
      title: "Ce que revele ce parcours..."
      icon: Sparkles
      children:
        - AIGeneratedText (max 300 chars)
    dimensions_8d:
      component: Card
      title: "Dimensions 8D"
      description: "Profil comportemental et competences"
      children:
        - ProgressList
          items: [leadership, image, sales, technical, management, communication, adaptability, vision]
          colors: [excellent (>85), good (70-85), average (<70)]
    career_path:
      component: Card
      title: "Empreinte Professionnelle"
      description: "Parcours chronologique"
      children:
        - Timeline (ordered DESC)
        - TimelineItem: [period, role, company, location, description, skills]
    alignments:
      component: Card
      title: "Alignements avec les Mandats"
      description: "Opportunites identifiees"
      children:
        - MatchCardsList
        - MatchCard: [mandate, company, score, score_label, summary, actions]
  right_column:
    sticky: true
    activity_history:
      component: Card
      title: "Historique"
      description: "Suivi CRM"
      children:
        - TimelineFeed
        - TimelineItem: [icon, title, author, time, preview, status]
    add_note_form:
      component: CollapsibleForm
      trigger: "Ajouter une Note..."
      expanded: false
      fields:
        - type: select (Note, Appel, Email, Reunion)
        - content: textarea
        - submit: button (primary, full_width)
    feedback_section:
      component: ClientFeedbackForm
      visible_to: [client]
      fields:
        - interest_level (1-5 stars)
        - comment (optional textarea)
  footer:
    contact_recruiter:
      component: ContactCard
      props: [recruiter_name, recruiter_email]
    branding:
      component: IrbisBranding
      props: [logo, tagline]

data:
  sources:
    - name: shareToken
      query: validateShareToken(token)
      returns: [candidateId, permissions, expiresAt, anonymize]
    - name: candidate
      query: getCandidateForShare(candidateId, permissions)
      filtered_by: permissions.visible_fields
    - name: synthesis
      query: getCandidateSynthesis(candidateId)
      type: ai-generated
      cache_ttl: 24h
    - name: dimensions8d
      query: get8DDimensions(candidateId)
      fields: [leadership, image, sales, technical, management, communication, adaptability, vision]
    - name: careerPath
      query: getCareerPath(candidateId)
      order: desc
    - name: matches
      query: getCandidateMatches(candidateId)
      order_by: score
      limit: 10
      visible_if: permissions.show_matches
    - name: activities
      query: getCandidateActivities(candidateId)
      order: desc
      limit: 20
      visible_to: [recruiter_preview]
  mutations:
    - name: submitFeedback
      action: submitClientFeedback(token, rating, comment)
      requires_captcha: true
    - name: addNote
      action: createActivity(candidateId, type, content)
      visible_to: [recruiter_preview]

accessibility:
  aria:
    - role: article
    - aria-label: "Presentation du talent"
    - aria-expanded on collapsible sections
    - aria-label on icon buttons
  keyboard:
    - Tab through all sections
    - Enter to expand collapsed forms
    - Escape to close modals
  contrast:
    - All text meets WCAG AA
    - Score colors have sufficient contrast
    - Focus indicators visible
  print:
    - Optimized for PDF export
    - Hide interactive elements
    - Full page layout
  responsive:
    mobile:
      - Stack columns vertically (left above right)
      - Timeline collapses to compact view
      - Add Note button fixed at bottom
      - Contact button sticky
    tablet:
      - Columns: 60/40 split
      - Right column scrollable
    desktop:
      - Columns: 2fr 1fr split
      - Right column sticky
      - Max-width container (1280px)

testing:
  e2e_scenarios:
    - name: "Valid share link loads profile"
      steps:
        - Navigate to /share/candidate/{valid_token}
        - Assert header visible (name or placeholder)
        - Assert synthesis card visible
        - Assert 8D dimensions visible
        - Assert career timeline visible
    - name: "Expired link shows message"
      steps:
        - Navigate to /share/candidate/{expired_token}
        - Assert 410 error page
        - Assert expiry message visible
        - Assert recruiter contact visible
    - name: "Anonymized mode hides sensitive data"
      steps:
        - Create share link with anonymize=true
        - Navigate to link
        - Assert name placeholder "Talent A"
        - Assert generic avatar shown
        - Assert no company names visible
        - Assert skills and synthesis visible
    - name: "Client submits feedback"
      steps:
        - Navigate to valid share link
        - Select 4 stars
        - Enter comment
        - Submit
        - Assert success toast
        - Verify feedback in recruiter dashboard
    - name: "Recruiter preview mode"
      steps:
        - Login as recruiter
        - Navigate to preview URL
        - Assert "Apercu recruteur" badge visible
        - Assert edit/copy/revoke actions available
  unit_tests:
    - 8D dimensions render with correct colors
    - Timeline items display in DESC order
    - Score colors match thresholds (>85 excellent, 70-85 good, <70 average)
    - Contact links work correctly (mailto/tel)
    - Collapsible form expands on trigger click
  security_tests:
    - Token cannot be guessed (UUID v4)
    - Expired token returns 410
    - Revoked token returns 403
    - Rate limiting on feedback submission
    - No PII leakage in error responses
